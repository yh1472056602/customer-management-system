# 智能地址解析集成指南

本系统支持智能地址解析功能，可以通过集成第三方API实现更准确的地址解析。

## 支持的API服务

### 1. 高德地图API
- 官网：https://lbs.amap.com/
- 申请Key：https://console.amap.com/dev/key/app

### 2. 百度地图API
- 官网：https://lbsyun.baidu.com/
- 申请AK：https://lbsyun.baidu.com/apiconsole/key

### 3. 腾讯地图API
- 官网：https://lbs.qq.com/
- 申请Key：https://lbs.qq.com/dev/console/key/manage

## 集成步骤

### 1. 申请API Key
以高德地图为例：

1. 访问高德开放平台
2. 注册账号并创建应用
3. 获取Web服务API Key

### 2. 修改前端代码

在 `frontend/js/customer-service.js` 中修改 `parseAddress` 函数：

```javascript
async function parseAddress() {
    const address = document.getElementById('customerAddress').value;
    if (!address) {
        alert('请输入地址');
        return;
    }
    
    try {
        // 高德地图API示例
        const apiKey = 'YOUR_AMAP_API_KEY';
        const response = await fetch(
            `https://restapi.amap.com/v3/geocode/geo?address=${encodeURIComponent(address)}&key=${apiKey}`
        );
        
        const data = await response.json();
        
        if (data.status === '1' && data.geocodes.length > 0) {
            const geocode = data.geocodes[0];
            const formattedAddress = geocode.formatted_address;
            const province = geocode.province;
            const city = geocode.city;
            const district = geocode.district;
            
            // 更新详细地址
            document.getElementById('detailedAddress').value = formattedAddress;
            
            // 可以进一步解析省市区
            console.log('省:', province, '市:', city, '区:', district);
            
            alert('地址解析完成！');
        } else {
            alert('地址解析失败，请检查地址格式');
        }
    } catch (error) {
        console.error('地址解析错误:', error);
        alert('地址解析失败，请手动填写');
    }
}
```

### 3. 百度地图API示例

```javascript
async function parseAddress() {
    const address = document.getElementById('customerAddress').value;
    if (!address) {
        alert('请输入地址');
        return;
    }
    
    try {
        const ak = 'YOUR_BAIDU_AK';
        const response = await fetch(
            `https://api.map.baidu.com/geocoding/v3/?address=${encodeURIComponent(address)}&output=json&ak=${ak}`
        );
        
        const data = await response.json();
        
        if (data.status === 0) {
            const result = data.result;
            const formattedAddress = result.formatted_address;
            
            document.getElementById('detailedAddress').value = formattedAddress;
            alert('地址解析完成！');
        } else {
            alert('地址解析失败，请检查地址格式');
        }
    } catch (error) {
        console.error('地址解析错误:', error);
        alert('地址解析失败，请手动填写');
    }
}
```

## 配置说明

### 环境变量配置

创建 `.env` 文件：

```bash
# 高德地图API配置
AMAP_API_KEY=your_amap_api_key_here

# 百度地图API配置
BAIDU_AK=your_baidu_ak_here

# 腾讯地图API配置
TENCENT_KEY=your_tencent_key_here
```

### 后端集成

如果需要后端处理地址解析，可以在 `backend/server.js` 中添加：

```javascript
// 地址解析接口
app.post('/api/parse-address', authenticateToken, async (req, res) => {
    const { address } = req.body;
    
    try {
        const apiKey = process.env.AMAP_API_KEY;
        const response = await axios.get(
            `https://restapi.amap.com/v3/geocode/geo?address=${encodeURIComponent(address)}&key=${apiKey}`
        );
        
        if (response.data.status === '1') {
            res.json(response.data.geocodes[0]);
        } else {
            res.status(400).json({ error: '地址解析失败' });
        }
    } catch (error) {
        res.status(500).json({ error: '解析服务错误' });
    }
});
```

## 使用建议

1. **API限制**：注意各平台的免费调用次数限制
2. **错误处理**：添加完善的错误处理机制
3. **缓存机制**：可以缓存常用地址解析结果
4. **隐私保护**：避免在客户端暴露API Key

## 常见问题

### Q: 地址解析不准确怎么办？
A: 可以尝试以下方法：
- 使用更详细的地址描述
- 切换到其他地图API
- 添加人工校验机制

### Q: API调用频率限制？
A: 各平台免费额度：
- 高德地图：5000次/日
- 百度地图：6000次/日
- 腾讯地图：10000次/日

### Q: 如何保护API Key？
A: 建议：
- 使用后端代理请求
- 设置Referer白名单
- 定期更换Key

## 测试地址

可以使用以下地址测试解析功能：
- 北京市朝阳区建国门外大街1号
- 上海市浦东新区世纪大道100号
- 深圳市南山区科技园南区

## 技术支持

如需更多帮助，请参考各平台的官方文档或联系技术支持。
